<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Usu√°rios</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Topo -->
  <header>
    <button onclick="openMenu()">‚ò∞</button>
    <h1>Painel de Usu√°rios</h1>
    <button onclick="openNotif()">üîî <span id="notifCount">0</span></button>
  </header>

  <!-- Menu lateral -->
  <div id="sideMenu" class="side-menu">
    <a href="javascript:void(0)" onclick="closeMenu()">√ó</a>
    <a href="admin_dashboard.html">Dashboard</a>
    <a href="admin_usuarios.html">Usu√°rios</a>
    <a href="admin_produtos.html">Produtos</a>
    <a href="admin_saques.html">Saques</a>
    <a href="admin_plans.html">Planos</a>
    <a href="admin_seguranca.html">Seguran√ßa</a>
  </div>

  <!-- Caixa de notifica√ß√µes -->
  <div id="notifBox" class="notif-box">
    <a href="javascript:void(0)" onclick="closeNotif()">√ó</a>
    <h3>Notifica√ß√µes</h3>
    <div id="notifList"></div>
  </div>

  <!-- Conte√∫do principal -->
  <main>
    <h2>Lista de Usu√°rios</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Email</th>
          <th>Tipo</th>
        </tr>
      </thead>
      <tbody id="usuariosTable">
        <tr><td colspan="4">Carregando usu√°rios...</td></tr>
      </tbody>
    </table>

    <h2>Gr√°fico de Usu√°rios</h2>
    <canvas id="usuariosChart" width="400" height="200"></canvas>
  </main>

  <script>
    // Notifica√ß√µes simuladas
    let notifications = [
      { text: "Novo usu√°rio cadastrado", link: "admin_usuarios.html" },
      { text: "Pedido de saque recebido", link: "admin_saques.html" },
      { text: "Novo produto adicionado", link: "admin_produtos.html" }
    ];

    function updateNotif() {
      const notifList = document.getElementById("notifList");
      notifList.innerHTML = "";
      let unread = 0;

      notifications.forEach((n, i) => {
        let div = document.createElement("div");
        div.className = "notif-item";
        div.textContent = n.text;
        div.onclick = () => {
          notifications[i].read = true;
          window.location.href = n.link;
        };
        notifList.appendChild(div);
        if (!n.read) unread++;
      });

      document.getElementById("notifCount").textContent = unread;
    }

    function openMenu() { document.getElementById("sideMenu").style.width = "250px"; }
    function closeMenu() { document.getElementById("sideMenu").style.width = "0"; }

    function openNotif() {
      document.getElementById("notifBox").style.width = "300px";
      updateNotif();
    }
    function closeNotif() { document.getElementById("notifBox").style.width = "0"; }

    // Carregar usu√°rios e gr√°fico
    async function carregarUsuarios() {
      try {
        const response = await fetch("http://localhost:3000/usuarios");
        const usuarios = await response.json();

        const tabela = document.getElementById("usuariosTable");
        tabela.innerHTML = "";

        let compradores = 0, vendedores = 0;

        if (usuarios.length === 0) {
          tabela.innerHTML = `<tr><td colspan="4">Nenhum usu√°rio encontrado</td></tr>`;
        } else {
          usuarios.forEach(user => {
            let row = `
              <tr>
                <td>${user.id}</td>
                <td>${user.nome}</td>
                <td>${user.email}</td>
                <td>${user.tipo}</td>
              </tr>
            `;
            tabela.innerHTML += row;

            if (user.tipo === "comprador") compradores++;
            else if (user.tipo === "vendedor") vendedores++;
          });
        }

        const ctx = document.getElementById("usuariosChart").getContext("2d");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["Compradores", "Vendedores"],
            datasets: [{
              data: [compradores, vendedores],
              backgroundColor: ["#36a2eb", "#ff6384"]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "bottom" }
            }
          }
        });
      } catch (error) {
        console.error("Erro ao carregar usu√°rios:", error);
      }
    }

    carregarUsuarios();
  </script>
</body>
</html>
